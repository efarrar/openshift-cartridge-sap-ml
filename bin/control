#!/bin/bash

source $OPENSHIFT_CARTRIDGE_SDK_BASH

function check_license {
# Display License File
client_result "======= SAP License ========="
#while read -r line; do client_result "$line"; done < head $OPENSHIFT_ML_DIR/license/license.txt
client_result "IMPORTANT - READ CAREFULLY BEFORE USING THE ACCOMPANYING SOFTWARE "
client_result ""
client_result "SAP SQL ANYWHERE DEVELOPER EDITION DEVELOPER LICENSE AGREEMENT-FOR INTERNAL"
client_result "TESTING AND DEVELOPMENT ONLY "
client_result ""
client_result "NOTICE TO USER: BY INSTALLING OR USING THIS SOFTWARE YOU ACCEPT ALL THE TERMS"
client_result "AND CONDITIONS OF THIS AGREEMENT. PLEASE READ IT CAREFULLY. "
client_result ""
client_result "THE FOLLOWING TERMS AND CONDITIONS ("AGREEMENT") SHALL GOVERN YOUR INSTALLATION"
client_result "AND USE OF THE ACCOMPANYING SOFTWARE, DOCUMENTATION AND RELATED EXPLANATORY"
client_result "MATERIALS (THE "PROGRAM"). IF YOU DO NOT ACCEPT OR AGREE WITH THESE TERMS, YOU"
client_result "MAY NOT INSTALL OR USE THE PROGRAM. "
client_result ""
client_result "YOU ARE REQUIRED TO ACCEPT THE TERMS OF THE AGREEMENT BEFORE YOU CONTINUE TO"
client_result "INSTALL OR USE THE PROGRAM. YOU INDICATE YOUR ACCEPTANCE OF THIS AGREEMENT BY"
client_result "CLICKING “I ACCEPT”, “I AGREE”, OR SIMILAR, BELOW, AND BY DOING SO, OR BY"
client_result "ATTEMPTING TO ACCESS OR USE THE PROGRAM, YOU AGREE THAT THIS DEVELOPER LICENSE"
client_result "AGREEMENT FORMS A LEGALLY BINDING AGREEMENT BETWEEN YOU (“YOU” OR “YOUR”) AND"
client_result "SAP AG, FOR AND ON BEHALF OF ITSELF AND ITS SUBSIDIARIES AND AFFILIATES (AS"
client_result "DEFINED IN SECTION 15 OF THE GERMAN STOCK CORPORATION ACT) (“SAP”), AND YOU"
client_result "AGREE TO BE BOUND BY ALL OF THE TERMS AND CONDITIONS STATED IN THIS DEVELOPER"
client_result "LICENSE AGREEMENT. IF YOU ARE TRYING TO ACCESS OR DOWNLOAD THE PROGRAM ON BEHALF"
client_result "OF YOUR EMPLOYER OR AS A CONSULTANT OR AGENT OF A THIRD PARTY (EITHER "YOUR"
client_result "COMPANY"), YOU REPRESENT AND WARRANT THAT YOU HAVE THE AUTHORITY TO ACT ON"
client_result "BEHALF OF AND BIND YOUR COMPANY TO THE TERMS OF THIS DEVELOPER LICENSE AGREEMENT"
client_result "AND EVERYWHERE IN THIS DEVELOPER LICENSE AGREEMENT THAT REFERS TO ‘YOU’ OR"
client_result "‘YOUR’ SHALL ALSO INCLUDE YOUR COMPANY. IF YOU DO NOT AGREE TO THESE TERMS, DO"
client_result "NOT CLICK "I ACCEPT", AND DO NOT ACCESS OR USE THE PROGRAM."
client_result ""
client_result "UPON YOUR ACCEPTANCE OF THIS AGREEMENT, SAP GRANTS YOU A LIMITED, NON-EXCLUSIVE"
client_result "LICENSE TO USE THE PROGRAM AS FOLLOWS: "
client_result ""
client_result "1. USE OF PROGRAM. You may install and use the Program internally in your"
client_result "organization solely for internal evaluation, testing and development of"
client_result "applications compatible with the Program. The license permits you to install and"
client_result "use one (1) copy of each of the components that accompany the Program, all of"
client_result "which shall be deemed part of the Program under this Agreement. The MobiLink"
client_result "Synchronization Server is licensed for the purpose of synchronization with the"
client_result "components that are provided with the Program.  Synchronization may be"
client_result "implemented by using Sybase Mobilink or Sybase SQL Remote as described in the"
client_result "SQL Anywhere documentation. You may not use the Program for any commercial or"
client_result "production purpose. The Program may not be transferred, sold, assigned,"
client_result "sublicensed or otherwise conveyed (whether by operation of law or otherwise) to"
client_result "another party without SAP's prior written consent.  2. COPY RESTRICTIONS AND"
client_result "OTHER RESTRICTIONS. You may not copy the Program except that you may either"
client_result "install the Program on your hard disk or make one copy for inactive back-up and"
client_result "archival purposes for your own use. Except as expressly permitted in the"
client_result "documentation, you may not modify or adapt the Program in whole or in part"
client_result "(including but not limited to translating or creating derivative works) or"
client_result "reverse engineer, decompile or disassemble the Program (except to the extent"
client_result "applicable laws specifically prohibit such restriction). You may not use the"
client_result "Program for timesharing, rental or service bureau purposes. You shall not remove"
client_result "any copyright notices or other proprietary notices from the Program or"
client_result "documentation and you must reproduce such notices on all copies or extracts of"
client_result "the Program and documentation. Results of benchmark or other performance tests"
client_result "run on the Program may not be disclosed to any third party without SAP's prior"
client_result "written consent. Transfer of the Program outside the country in which it was"
client_result "originally delivered to you is not permitted without SAP´s prior written"
client_result "consent, and is subject to compliance with all applicable export regulations and"
client_result "restrictions. Upon reasonable notice to you, SAP may audit your use of the"
client_result "Program. The Program may be provided to you for download and use locally on your"
client_result "own server, computer, or other electronic device, or for remote use and access"
client_result "through a web services account. There shall be no license fee for use of the"
client_result "Program. However, in the event that You access the Program through a web"
client_result "services account, that account may require payments by You to the applicable"
client_result "provider."
client_result ""
client_result "3. COPYRIGHT AND OWNERSHIP. The Program is owned by SAP, its subsidiaries or"
client_result "their suppliers and is protected by copyright laws and international treaty"
client_result "provisions. You acquire only the non-exclusive right to use the Program as"
client_result "permitted herein and do not acquire any rights of ownership in the Program or"
client_result "any other implied rights or licenses under any intellectual property rights of"
client_result "SAP. "
client_result ""
client_result "4. SUPPORT. The Program is provided on an "as is" basis and is unsupported. This"
client_result "Agreement does not entitle you to any maintenance or other services or any"
client_result "updates or new versions of the Program. "
client_result ""
client_result "5. CONFIDENTIAL INFORMATION. "Confidential Information" shall include the"
client_result "Program (including methods or concepts utilized therein) and all information"
client_result "identified by SAP as proprietary or confidential. Confidential Information shall"
client_result "remain the sole property of SAP and shall not be disclosed to any third party"
client_result "without the express written consent of SAP; except that you may disclose"
client_result "Confidential Information to consultants performing services for your benefit,"
client_result "provided that such consultants are bound by a written non-disclosure agreement"
client_result "with you protecting such Confidential Information in a manner consistent with"
client_result "this Agreement. Except with respect to the Program, items will not be deemed"
client_result "Confidential Information if (i) available to the public other than by a breach"
client_result "of an agreement with SAP; (ii) rightfully received from a third party not in"
client_result "breach of any obligation of confidentiality; (iii) independently developed by"
client_result "you without access to the Confidential Information; or (iv) if proven to have"
client_result "been known to you at the time of disclosure. You shall immediately inform SAP if"
client_result "you are required to produce Confidential Information by operation of law, and if"
client_result "so requested by SAP, shall provide reasonable assistance to SAP in seeking to"
client_result "limit such production. A copyright notice on the Program does not, by itself,"
client_result "constitute evidence of publication or public disclosure. "
client_result ""
client_result "6. U.S. GOVERNMENT RESTRICTED RIGHTS. The Program is Commercial Computer"
client_result "Software. Use, duplication and disclosure of the Program and documentation by"
client_result "the U.S. Government is subject to restrictions set forth in this license or in a"
client_result "written agreement specifying the Government's right to use the Program. SAP"
client_result "reserves all unpublished rights under U.S. copyright laws.  7.	WARRANTY"
client_result "DISCLAIMERS: a)	If You are located outside the US or Canada: AS THE PROGRAM IS"
client_result "PROVIDED TO YOU FREE OF CHARGE, SAP DOES NOT GUARANTEE OR WARRANT ANY FEATURES"
client_result "OR QUALITIES OF PROGRAM OR GIVE ANY UNDERTAKING WITH REGARD TO ANY OTHER"
client_result "QUALITY. NO SUCH WARRANTY OR UNDERTAKING SHALL BE IMPLIED BY YOU FROM ANY"
client_result "DESCRIPTION IN THE PROGRAM ITSELF OR ANY AVAILABLE DOCUMENTATION OR ANY OTHER"
client_result "COMMUNICATION OR ADVERTISEMENT FOR PROGRAM EXCEPT TO THE EXTENT THAT SAP HAS"
client_result "EXPRESSLY CONFIRMED A SPECIFIC QUALITY IN WRITING. IN PARTICULAR, SAP DOES NOT"
client_result "WARRANT THAT THE PROGRAM WILL BE AVAILABLE UNINTERRUPTED OR PERMANENTLY. ALL"
client_result "WARRANTY CLAIMS ARE SUBJECT TO THE LIMITATION OF LIABILITY STIPULATED IN SECTION"
client_result "BELOW. "
client_result ""
client_result "b)	If You are located in the US or Canada: THE PROGRAM IS LICENSED TO YOU"
client_result "“AS IS”, WITHOUT ANY WARRANTY, ESCROW, TRAINING, MAINTENANCE, OR SERVICE"
client_result "OBLIGATIONS WHATSOEVER ON THE PART OF SAP. SAP MAKES NO EXPRESS OR IMPLIED"
client_result "WARRANTIES OF ANY TYPE WHATSOEVER, INCLUDING BUT NOT LIMITED TO IMPLIED"
client_result "WARRANTIES OF MERCHANTABILITY AND OF FITNESS FOR A PARTICULAR PURPOSE. YOU"
client_result "ASSUME ALL RISKS ASSOCIATED WITH THE USE OF THE PROGRAM, INCLUDING WITHOUT"
client_result "LIMITATION RISKS RELATING TO QUALITY, AVAILABILITY, PERFORMANCE, DATA LOSS, AND"
client_result "UTILITY IN A PRODUCTION ENVIRONMENT. IN PARTICULAR, SAP DOES NOT WARRANT THAT"
client_result "THE PROGRAM WILL BE AVAILABLE UNINTERRUPTED OR PERMANENTLY."
client_result ""
client_result ""
client_result "==== End of SAP License ====="
client_result ""
client_result "======= MUST READ ==========="
client_result "You haven't accepted the license agreement,"
client_result "thus the use of the cartridge is prohibited."
client_result "-----------------------------"
client_result "To indicate that you accept this license, "
client_result "please set the ACCEPT_SAP_LICENSE_ML variable to "Y" with command:"
client_result "  rhc set-env ACCEPT_SAP_LICENSE_ML=Y --app ${OPENSHIFT_APP_NAME}"
client_result "then start the cartridge with command:"
client_result "  rhc cartridge-start mobilink --app ${OPENSHIFT_APP_NAME}"
client_result "============================="
return 0
}

function start {
if [ ${ACCEPT_SAP_LICENSE_ML} == Y ] || [ ${ACCEPT_SAP_LICENSE_ML} == y ]; then
  $OPENSHIFT_ML_DIR/versions/16.0/mobilink/mlsrv16 -c "Driver=${OPENSHIFT_ML_DIR}/versions/16.0/mysql-connector-odbc-5.1.6-linux-glibc2.3-x86-64bit/lib/libmyodbc5.so;Server=${OPENSHIFT_MYSQL_DB_HOST};Database=${ML_DB_NAME};uid=${ML_USERNAME};pwd=${ML_PASSWORD}" -ud -zs $OPENSHIFT_APP_NAME -x http{host=$OPENSHIFT_ML_HOST\;port=$OPENSHIFT_ML_PORT} -o $OPENSHIFT_LOG_DIR/ml.log -zf -zu+
else
  check_license
fi
}

function stop {
  $OPENSHIFT_ML_DIR/versions/16.0/mobilink/mlstop $OPENSHIFT_APP_NAME
}

case "$1" in
  start)
    start
  ;;
  stop)
    stop
  ;;
  *)
    echo 0
  ;;
esac
