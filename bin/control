#!/bin/bash

source $OPENSHIFT_CARTRIDGE_SDK_BASH

function check_license {
# Display License File
client_result "======= SAP License ========="
#while read -r line; do client_result "$line"; done < head $OPENSHIFT_ML_DIR/license/license.txt
client_result "IMPORTANT - READ CAREFULLY BEFORE USING THE ACCOMPANYING SOFTWARE "
client_result ""
client_result "SAP SQL ANYWHERE DEVELOPER EDITION DEVELOPER LICENSE AGREEMENT-FOR INTERNAL"
client_result "TESTING AND DEVELOPMENT ONLY "
client_result ""
client_result "NOTICE TO USER: BY INSTALLING OR USING THIS SOFTWARE YOU ACCEPT ALL THE TERMS"
client_result "AND CONDITIONS OF THIS AGREEMENT. PLEASE READ IT CAREFULLY. "
client_result ""
client_result "THE FOLLOWING TERMS AND CONDITIONS ("AGREEMENT") SHALL GOVERN YOUR INSTALLATION"
client_result "AND USE OF THE ACCOMPANYING SOFTWARE, DOCUMENTATION AND RELATED EXPLANATORY"
client_result "MATERIALS (THE "PROGRAM"). IF YOU DO NOT ACCEPT OR AGREE WITH THESE TERMS, YOU"
client_result "MAY NOT INSTALL OR USE THE PROGRAM. "
client_result ""
client_result "YOU ARE REQUIRED TO ACCEPT THE TERMS OF THE AGREEMENT BEFORE YOU CONTINUE TO"
client_result "INSTALL OR USE THE PROGRAM. YOU INDICATE YOUR ACCEPTANCE OF THIS AGREEMENT BY"
client_result "CLICKING “I ACCEPT”, “I AGREE”, OR SIMILAR, BELOW, AND BY DOING SO, OR BY"
client_result "ATTEMPTING TO ACCESS OR USE THE PROGRAM, YOU AGREE THAT THIS DEVELOPER LICENSE"
client_result "AGREEMENT FORMS A LEGALLY BINDING AGREEMENT BETWEEN YOU (“YOU” OR “YOUR”) AND"
client_result "SAP AG, FOR AND ON BEHALF OF ITSELF AND ITS SUBSIDIARIES AND AFFILIATES (AS"
client_result "DEFINED IN SECTION 15 OF THE GERMAN STOCK CORPORATION ACT) (“SAP”), AND YOU"
client_result "AGREE TO BE BOUND BY ALL OF THE TERMS AND CONDITIONS STATED IN THIS DEVELOPER"
client_result "LICENSE AGREEMENT. IF YOU ARE TRYING TO ACCESS OR DOWNLOAD THE PROGRAM ON BEHALF"
client_result "OF YOUR EMPLOYER OR AS A CONSULTANT OR AGENT OF A THIRD PARTY (EITHER "YOUR"
client_result "COMPANY"), YOU REPRESENT AND WARRANT THAT YOU HAVE THE AUTHORITY TO ACT ON"
client_result "BEHALF OF AND BIND YOUR COMPANY TO THE TERMS OF THIS DEVELOPER LICENSE AGREEMENT"
client_result "AND EVERYWHERE IN THIS DEVELOPER LICENSE AGREEMENT THAT REFERS TO ‘YOU’ OR"
client_result "‘YOUR’ SHALL ALSO INCLUDE YOUR COMPANY. IF YOU DO NOT AGREE TO THESE TERMS, DO"
client_result "NOT CLICK "I ACCEPT", AND DO NOT ACCESS OR USE THE PROGRAM."
client_result ""
client_result "UPON YOUR ACCEPTANCE OF THIS AGREEMENT, SAP GRANTS YOU A LIMITED, NON-EXCLUSIVE"
client_result "LICENSE TO USE THE PROGRAM AS FOLLOWS: "
client_result ""
client_result "==== End of SAP License ====="
client_result ""
client_result "======= MUST READ ==========="
client_result "You haven't accepted the license agreement,"
client_result "thus the use of the cartridge is prohibited."
client_result "-----------------------------"
client_result "To indicate that you accept this license, "
client_result "please set the ACCEPT_SAP_LICENSE_ML variable to "Y" with command:"
client_result "  rhc set-env ACCEPT_SAP_LICENSE_ML=Y --app ${OPENSHIFT_APP_NAME}"
client_result "then start the cartridge with command:"
client_result "  rhc cartridge-start mobilink --app ${OPENSHIFT_APP_NAME}"
client_result "============================="
return 0
}

function start {
if [ ${ACCEPT_SAP_LICENSE_ML} == Y ] || [ ${ACCEPT_SAP_LICENSE_ML} == y ]; then
  $OPENSHIFT_ML_DIR/versions/16.0/mobilink/mlsrv16 -c "Driver=${OPENSHIFT_ML_DIR}/versions/16.0/mysql-connector-odbc-5.1.6-linux-glibc2.3-x86-64bit/lib/libmyodbc5.so;Server=${OPENSHIFT_MYSQL_DB_HOST};Database=${ML_DB_NAME};uid=${ML_USERNAME};pwd=${ML_PASSWORD}" -ud -zs $OPENSHIFT_APP_NAME -x http{host=$OPENSHIFT_ML_HOST\;port=$OPENSHIFT_ML_PORT} -o $OPENSHIFT_LOG_DIR/ml.log -zf -zu+
else
  check_license
fi
}

function stop {
  $OPENSHIFT_ML_DIR/versions/16.0/mobilink/mlstop $OPENSHIFT_APP_NAME
}

case "$1" in
  start)
    start
  ;;
  stop)
    stop
  ;;
  *)
    echo 0
  ;;
esac
